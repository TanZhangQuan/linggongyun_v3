package com.example.merchant.controller.platform;


import com.example.common.util.ReturnJson;
import com.example.merchant.dto.MakerInvoiceDTO;
import com.example.merchant.dto.MakerTotalInvoiceDTO;
import com.example.merchant.interceptor.LoginRequired;
import com.example.merchant.service.InvoiceService;
import com.example.merchant.service.MakerInvoiceService;
import com.example.merchant.service.MakerTotalInvoiceService;
import com.example.mybatis.dto.AddInvoiceDTO;
import com.example.mybatis.dto.QueryMakerTotalInvoiceDTO;
import com.example.mybatis.dto.TobeInvoicedDTO;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

import javax.annotation.Resource;
import javax.validation.Valid;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;

/**
 * <p>
 * 发票相关 前端控制器
 * </p>
 *
 * @author hzp
 * @since 2020-09-07
 */
@Api(tags = "平台端总包+分包发票", value = "平台端总包+分包发票")
@RestController
@RequestMapping("/platform/invoice")
@Validated
public class InvoicePassController {

    @Resource
    private InvoiceService invoiceService;

    @Resource
    private MakerTotalInvoiceService makerTotalInvoiceService;

    @Resource
    private MakerInvoiceService makerInvoiceService;

    @ApiOperation("总包开票，待开票")
    @PostMapping("/getPlaInvoiceList")
    public ReturnJson getPlaInvoiceList(@Valid @RequestBody TobeInvoicedDTO tobeinvoicedDto) {
        return invoiceService.getPlaInvoiceList(tobeinvoicedDto);
    }

    @ApiOperation("总包开票，详情数据")
    @PostMapping("/getPlaInvoiceInfo")
    public ReturnJson getPlaInvoiceInfo(String applicationID) {
        return invoiceService.getPlaInvoiceInfo(applicationID);
    }

    @ApiOperation("总包开票，编辑详情数据")
    @PostMapping("/queryInvoice")
    public ReturnJson queryInvoice(String invoiceId) {
        return invoiceService.queryInvoice(invoiceId);
    }

    @ApiOperation("总包开票")
    @PostMapping("/saveInvoice")
    public ReturnJson saveInvoice(@Valid @RequestBody AddInvoiceDTO addInvoiceDto) {
        return invoiceService.saveInvoice(addInvoiceDto);
    }

    @ApiOperation("总包开票，以开票")
    @PostMapping("/listInvoiceQuery")
    public ReturnJson listInvoiceQuery(@Valid @RequestBody TobeInvoicedDTO tobeinvoicedDto) {
        return invoiceService.getListInvoicequery(tobeinvoicedDto);
    }

    @ApiOperation("分包开票，待开票")
    @PostMapping("/listSubQuery")
    public ReturnJson listSubQuery(@Valid @RequestBody TobeInvoicedDTO tobeinvoicedDto) {
        return invoiceService.getListSubQuery(tobeinvoicedDto);
    }

    @ApiOperation("分包开票，开票清单明细信息")
    @PostMapping("/invoiceListQuery")
    public ReturnJson invoiceListQuery(String invoiceId) {
        return invoiceService.getInvoiceListQuery(invoiceId);
    }

    @ApiOperation("汇总代开")
    @PostMapping("/saveOrUpdateMakerTotalInvoice")
    @LoginRequired
    public ReturnJson saveOrUpdateMakerTotalInvoice(@Valid @RequestBody MakerTotalInvoiceDTO makerTotalInvoiceDto,
                                                    @RequestAttribute("userId") @ApiParam(hidden = true) String managerId) {
        return makerTotalInvoiceService.saveOrUpdateMakerTotalInvoice(makerTotalInvoiceDto, managerId);
    }

    @ApiOperation("门征单开,开票清单明细信息")
    @PostMapping("/getPaymentInventory")
    public ReturnJson getPaymentInventory(String invoiceId) {
        return makerInvoiceService.getPaymentInventory(invoiceId);
    }

    @ApiOperation("门征单开,开票如果未开票先上传发票进这里开一张发票")
    @PostMapping("/saveMakerInvoice")
    public ReturnJson saveMakerInvoice(@Valid @RequestBody MakerInvoiceDTO makerInvoiceDto) {
        return makerInvoiceService.saveMakerInvoice(makerInvoiceDto);
    }

    @ApiOperation("汇总代开详情")
    @PostMapping("/queryMakerTotalInvoiceInfo")
    public ReturnJson queryMakerTotalInvoiceInfo(String invoiceIds) {
        return makerTotalInvoiceService.queryMakerTotalInvoiceInfo(invoiceIds);
    }

    @ApiOperation("分包已开票，汇总代开列表")
    @PostMapping("/queryMakerTotalInvoice")
    public ReturnJson queryMakerTotalInvoice(@Valid @RequestBody QueryMakerTotalInvoiceDTO queryMakerTotalInvoiceDto) {
        return makerTotalInvoiceService.queryMakerTotalInvoice(queryMakerTotalInvoiceDto);
    }

    @ApiOperation("分包已开票，汇总代开详情")
    @PostMapping("/queryMakerTotalInvoiceDetails")
    public ReturnJson queryMakerTotalInvoiceDetails(String invoiceId) {
        return makerTotalInvoiceService.queryMakerTotalInvoiceDetails(invoiceId);
    }

    @ApiOperation("分包已开票，汇总代开支付清单详情")
    @PostMapping("/getMakerTotalInvoicePayList")
    public ReturnJson getMakerTotalInvoicePayList(@RequestParam @NotNull(message = "发票ID不能为空") String invoiceId,
                                                  @RequestParam(defaultValue = "1") Integer pageNo,
                                                  @RequestParam(defaultValue = "10") Integer pageSize) {
        return makerTotalInvoiceService.getMakerTotalInvoicePayList(invoiceId, pageNo, pageSize);
    }


    @ApiOperation("总包+分包支付明细,id可以传多个用逗号隔开")
    @PostMapping("/getTotalBranchList")
    public ReturnJson getTotalBranchList(@RequestParam @NotBlank(message = "支付ID不能为空") String paymentOrderIds,
                                         @RequestParam @NotNull(message = "支付类型不能为空") Integer type) {
        return makerTotalInvoiceService.getTotalBranchList(paymentOrderIds,type);
    }

}